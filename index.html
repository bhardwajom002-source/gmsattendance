<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Data Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #6dd5fa, #2980b9);
        margin: 0;
        padding: 0;
        color: #fff;
    }
    .login-box, .dashboard {
        width: 90%; max-width: 480px;
        background: rgba(255,255,255,0.2);
        backdrop-filter: blur(10px);
        padding: 25px; margin: 40px auto;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    h2, h3 { text-align: center; }
    input, button, select {
        width: 100%; padding: 10px;
        margin: 10px 0; border: none; border-radius: 8px;
    }
    button {
        background: #ffcc00;
        font-weight: 600;
        cursor: pointer;
    }
    .hidden { display: none; }
    .photo-box { text-align: center; margin-top: 10px; }
    .photo-box img { width: 120px; height: 150px; border-radius: 6px; object-fit: cover; border: 2px solid #fff; }
    table { width: 100%; margin-top: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; }
    th, td { padding: 10px; text-align: left; }
</style>
</head>
<body>

<div class="login-box" id="loginBox">
    <h2>G.M.S MIDDLE SCHOOL DHAMALA<br>Class 8th</h2>
    <h3>Login</h3>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<div class="dashboard hidden" id="dashboard">
    <h2>Student Dashboard</h2>

    <input type="text" id="rollSearch" placeholder="Search by Roll No">
    <button onclick="searchStudent()">Search</button>

    <div id="studentInfo" class="hidden">
        <div class="photo-box"><img id="studentPhoto"></div>
        <table>
            <tr><th>Name:</th><td id="sName"></td></tr>
            <tr><th>Roll No:</th><td id="sRoll"></td></tr>
            <tr><th>Father Name:</th><td id="sFather"></td></tr>
            <tr><th>Mother Name:</th><td id="sMother"></td></tr>
            <tr><th>Aadhar No:</th><td id="sAadhar"></td></tr>
            <tr><th>DOB:</th><td id="sDob"></td></tr>
            <tr><th>Total Present:</th><td id="sPresent"></td></tr>
            <tr><th>Total Absent:</th><td id="sAbsent"></td></tr>
        </table>
    </div>

    <h3>Add Student Data</h3>
    <input type="text" id="name" placeholder="Student Name">
    <input type="text" id="roll" placeholder="Roll No">
    <input type="text" id="father" placeholder="Father Name">
    <input type="text" id="mother" placeholder="Mother Name">
    <input type="text" id="aadhar" placeholder="Aadhar No">
    <input type="date" id="dob">
    <input type="number" id="present" placeholder="Total Present">
    <input type="number" id="absent" placeholder="Total Absent">
    <label>Upload Passport Size Photo:</label>
    <input type="file" id="photo">

    <button onclick="saveData()">Save to Google Sheet</button>
</div>

<script>
function login(){
    if(username.value === "rekha" && password.value === "rekha"){
        loginBox.classList.add("hidden");
        dashboard.classList.remove("hidden");
    } else {
        alert("Wrong Username or Password");
    }
}

function saveData(){
    const url = "https://script.google.com/macros/s/AKfycbw_ckog-_2qnbu2_XqK4ZujynqlKCl2XoDmQ4HtmWNZxNj6Ld6GP6zpgCokJ9vUMNiQ/exec";

    let photoFile = document.getElementById('photo').files[0];
    let reader = new FileReader();

    reader.onload = function(){
        let photoBase64 = reader.result;

        let data = {
            name: name.value,
            roll: roll.value,
            father: father.value,
            mother: mother.value,
            aadhar: aadhar.value,
            dob: dob.value,
            present: present.value,
            absent: absent.value,
            photo: photoBase64
        };

        fetch(url, {
            method: "POST",
            body: JSON.stringify(data)
        })
        .then(res => res.text())
        .then(msg => alert(msg))
        .catch(err => alert("Error: " + err));
    };

    if(photoFile) reader.readAsDataURL(photoFile);
    else alert("Please upload a photo");
}

function searchStudent(){
    const url = "https://script.google.com/macros/s/AKfycbw_ckog-_2qnbu2_XqK4ZujynqlKCl2XoDmQ4HtmWNZxNj6Ld6GP6zpgCokJ9vUMNiQ/exec?roll=" + rollSearch.value;

    fetch(url)
    .then(res => res.json())
    .then(data => {
        if(data.status === "not found"){
            alert("Student Not Found");
            return;
        }

        studentInfo.classList.remove("hidden");
        sName.textContent = data.name;
        sRoll.textContent = data.roll;
        sFather.textContent = data.father;
        sMother.textContent = data.mother;
        sAadhar.textContent = data.aadhar;
        sDob.textContent = data.dob;
        sPresent.textContent = data.present;
        sAbsent.textContent = data.absent;
        studentPhoto.src = data.photo;
    })
    .catch(err => alert("Error: " + err));
}
</script>

</body>
</html>